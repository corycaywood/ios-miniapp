language: swift
xcode_workspace: MiniApp.xcworkspace
xcode_scheme: Tests
osx_image: xcode11.2
os: osx

cache:
  - bundler

before_install:
  # update necessary pods only instead of running `pod repo update`
  # https://github.com/travis-ci/travis-ci/issues/6473 
  - pod outdated | awk '{ if ( $1 ~ /^-/ ) { print $0 } }' | awk '{ if ( $3 != $5 ) { pod update $2 } else { print "No updated needed it for" $2 } }'

script:
- travis_wait bundle exec fastlane ci

after_success:
# Upload code coverage
- bundle exec jazzy \
  --xcodebuild-arguments -scheme,Tests \
  --module MiniApp \
  --source-directory MiniApp \
  --podspec MiniApp.podspec \
  --readme USERGUIDE.md

deploy:
  # Deploy Docs to Github Pages when tagged as release
  provider: pages
  strategy: git
  cleanup: false
  token: $GITHUB_TOKEN
  keep_history: true
  local_dir: docs
  on:
    tags: true
    condition: $TRAVIS_TAG =~ ^v
